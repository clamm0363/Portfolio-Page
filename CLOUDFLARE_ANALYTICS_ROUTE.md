# analytics.clamm-translation.net のルート設定（Cloudflare Tunnel）

## 📌 重要：2種類の設定が必要

Cloudflare Zero Trust のトンネルでは、**ホスト名ルート**と**公開されたアプリケーションルート**の両方が必要です。

| タブ | 役割 | 設定内容 |
|------|------|----------|
| **ホスト名ルート** | どのホスト名をトンネルで扱うか | ホスト名・説明のみ（Service URL はここでは設定しない） |
| **公開されたアプリケーションルート** | ホスト名 → どこに転送するか | **公開ホスト名・パス・サービスURL** を設定する |

`analytics.clamm-translation.net` にアクセスするには、**公開されたアプリケーションルート**にルートを追加する必要があります。

---

## ✅ 手順：公開されたアプリケーションルートを追加

### 1. トンネル詳細を開く

1. **Zero Trust** → **Networks** → **Tunnels**
2. **Home-lab** をクリック

### 2. 「公開されたアプリケーションルート」タブを開く

3. **「公開されたアプリケーションルート」** タブをクリック（「ホスト名ルート」の右隣）

### 3. 新しいルートを追加

4. **「+ 公開されたアプリケーションルートを追加する」** ボタンをクリック

### 4. フォームに入力

以下のように入力します。

| 項目 | 入力値 |
|------|--------|
| **公開されたアプリケーションルート**（または ドメイン/ホスト名） | `analytics.clamm-translation.net` |
| **パス** | `*`（ワイルドカード、すべてのパス） |
| **サービス**（Type） | `HTTP` |
| **URL**（転送先） | `192.168.0.110:80`（NPM のアドレス） |

※NPMで `analytics.clamm-translation.net` → Umami(192.168.0.94:3002) の Proxy Host を設定済みの場合、Tunnel の転送先は **NPM** にします。NPM が Host ヘッダーで Umami に振り分けます。

※「公開されたアプリケーションルート」の欄が「ドメイン」と「サブドメイン」に分かれている場合は：
- **ドメイン**: `clamm-translation.net`
- **サブドメイン**: `analytics`

### 5. 保存

5. **「保存」** または **「Save」** をクリック

---

## 🔍 確認

- 一覧に `analytics.clamm-translation.net` と `http://192.168.0.110:80`（NPM）が表示されていること
- 数分待ってからブラウザで **https://analytics.clamm-translation.net** にアクセス
- Umami のログイン画面が表示されれば成功です

---

## 📝 補足

- **ホスト名ルート**の「analytics.clamm-translation.net」は、そのホスト名をトンネルで扱うための宣言です。編集画面に「ホスト名」「説明」しかないのは仕様です。
- 実際の転送先（Service URL）は **公開されたアプリケーションルート** で設定します。
- NPM を入口にしている場合は、Tunnel の転送先は **NPM のアドレス（192.168.0.110:80）** にします。NPM 側で `analytics.clamm-translation.net` 用の Proxy Host を設定しておけば、NPM が Umami（192.168.0.94:3002）に振り分けます。
